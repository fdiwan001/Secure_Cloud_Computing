{"ast":null,"code":"import _regeneratorRuntime from\"/home/kali/Desktop/Secure_Cloud_Computing/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/kali/Desktop/Secure_Cloud_Computing/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/home/kali/Desktop/Secure_Cloud_Computing/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/kali/Desktop/Secure_Cloud_Computing/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback,useEffect,useState,useRef}from'react';import Quill from\"quill\";import\"quill/dist/quill.snow.css\";import{io}from'socket.io-client';import{useParams}from'react-router-dom';import{useAuth}from'../../contexts/AuthContext';import{faFileAlt,faShare}from'@fortawesome/free-solid-svg-icons';import{Button,Modal,Form}from\"react-bootstrap\";import{FontAwesomeIcon}from\"@fortawesome/react-fontawesome\";import{firestore}from'../../firebase';import{Helmet}from\"react-helmet\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var TOOLBAR_OPTIONS=[[{header:[1,2,3,4,5,6,false]}],[{font:[]}],[{list:\"ordered\"},{list:\"bullet\"}],[\"bold\",\"italic\",\"underline\"],[{color:[]},{background:[]}],[{script:\"sub\"},{script:\"super\"}],[{align:[]}],[\"image\",\"blockquote\",\"code-block\"],[\"clean\"]];var SAVE_INTERVAL_MS=2000;export default function TextEditor(){var _useParams=useParams(),documentId=_useParams.id;var _useState=useState(),_useState2=_slicedToArray(_useState,2),socket=_useState2[0],setSocket=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),quill=_useState4[0],setQuill=_useState4[1];var _useAuth=useAuth(),currentUser=_useAuth.currentUser;console.log(documentId);console.log(\"current user is \",currentUser.uid);var userid=[];userid.push(currentUser.uid);var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),open=_useState6[0],setOpen=_useState6[1];var emailRef=useRef();var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),name=_useState8[0],setName=_useState8[1];var docInfo={userid:userid,id:documentId};function openModal(){setOpen(true);}function closeModal(){setOpen(false);}function shareSubmit(e){e.preventDefault();console.log(\"email is \",emailRef.current.value);console.log(\"email is \",emailRef.current.value);firestore.collection('users').doc(emailRef.current.value).get().then(function(doc){var user=[];user.push(doc.data().userid);var user1=[];user1.push(currentUser.uid);user=[].concat(_toConsumableArray(user),user1);console.log(\"user is \",user);firestore.collection('documents').doc(documentId).update({userId:user,shared:\"yes\"});});closeModal();}var filehandle=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var docRef,doc;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;docRef=firestore.collection('documents').doc(documentId);console.log(name);_context.next=6;return docRef.set({name:name},{merge:true});case 6:doc=_context.sent;console.log(name);_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](1);console.log(_context.t0);case 13:closeModal();case 14:case\"end\":return _context.stop();}}},_callee,null,[[1,10]]);}));return function filehandle(_x){return _ref.apply(this,arguments);};}();useEffect(function(){var s=io(\"http://localhost:3001\");setSocket(s);return function(){s.disconnect();};},[]);useEffect(function(){if(socket==null||quill==null)return;socket.once(\"load-document\",function(document){console.log(document);quill.setContents(document);quill.enable();});socket.emit('get-document',docInfo);//socket.emit('get-userid', userid)\n},[socket,quill,docInfo]);useEffect(function(){if(socket==null||quill==null)return;var interval=setInterval(function(){socket.emit(\"save-document\",quill.getContents());},SAVE_INTERVAL_MS);return function(){clearInterval(interval);};},[socket,quill]);useEffect(function(){if(socket==null||quill==null)return;var handler=function handler(delta,oldDelta,source){if(source!=='user')return;socket.emit(\"send-changes\",delta);};quill.on('text-change',handler);return function(){quill.off('text-change',handler);};},[socket,quill]);useEffect(function(){if(socket==null||quill==null)return;var handler=function handler(delta){quill.updateContents(delta);};socket.on(\"receive-changes\",handler);return function(){socket.off(\"receive-changes\",handler);};},[socket,quill]);var wrapperRef=useCallback(function(wrapper){if(wrapper==null)return;wrapper.innerHTML=\"\";var editor=document.createElement(\"div\");wrapper.append(editor);var q=new Quill(editor,{theme:\"snow\",modules:{toolbar:TOOLBAR_OPTIONS}});q.disable();q.setText(\"Loading ...\");setQuill(q);},[]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Helmet,{children:[/*#__PURE__*/_jsx(\"link\",{rel:\"stylesheet\",href:\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\",integrity:\"sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T\",crossorigin:\"anonymous\"}),/*#__PURE__*/_jsx(\"script\",{src:\"https://code.jquery.com/jquery-3.3.1.slim.min.js\",integrity:\"sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo\",crossorigin:\"anonymous\"}),/*#__PURE__*/_jsx(\"script\",{src:\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js\",integrity:\"sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1\",crossorigin:\"anonymous\"}),/*#__PURE__*/_jsx(\"script\",{src:\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js\",integrity:\"sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM\",crossorigin:\"anonymous\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-primary\",\"data-toggle\":\"modal\",\"data-target\":\"#exampleModal\",children:\"Rename File\"}),/*#__PURE__*/_jsx(\"div\",{className:\"modal fade\",id:\"exampleModal\",tabIndex:\"-1\",role:\"dialog\",\"aria-labelledby\":\"exampleModalLabel\",\"aria-hidden\":\"true\",children:/*#__PURE__*/_jsx(\"div\",{className:\"modal-dialog\",role:\"document\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"modal-title\",id:\"exampleModalLabel\",children:\"File Name\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"close\",\"data-dismiss\":\"modal\",\"aria-label\":\"Close\",children:/*#__PURE__*/_jsx(\"span\",{\"aria-hidden\":\"true\",children:\"\\xD7\"})})]}),/*#__PURE__*/_jsxs(Form,{onSubmit:filehandle,children:[/*#__PURE__*/_jsx(\"div\",{className:\"modal-body\",children:/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Document Name\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",required:true,value:name,onChange:function onChange(e){return setName(e.target.value);}})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-footer\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-secondary\",\"data-dismiss\":\"modal\",children:\"Close\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-primary\",children:\"Save changes\"})]})]})]})})}),/*#__PURE__*/_jsx(Button,{onClick:openModal,variant:\"outline-success\",size:\"sm\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faShare})}),/*#__PURE__*/_jsx(Modal,{show:open,onHide:closeModal,children:/*#__PURE__*/_jsxs(Form,{onSubmit:shareSubmit,children:[/*#__PURE__*/_jsx(Modal.Body,{children:/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"User Email\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"email\",ref:emailRef,required:true})]})}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:closeModal,children:\"Close\"}),/*#__PURE__*/_jsx(Button,{variant:\"success\",type:\"submit\",children:\"Enter\"})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"container\",ref:wrapperRef})]});}","map":{"version":3,"sources":["/home/kali/Desktop/Secure_Cloud_Computing/src/Component/Document/TextEditor.js"],"names":["React","useCallback","useEffect","useState","useRef","Quill","io","useParams","useAuth","faFileAlt","faShare","Button","Modal","Form","FontAwesomeIcon","firestore","Helmet","TOOLBAR_OPTIONS","header","font","list","color","background","script","align","SAVE_INTERVAL_MS","TextEditor","documentId","id","socket","setSocket","quill","setQuill","currentUser","console","log","uid","userid","push","open","setOpen","emailRef","name","setName","docInfo","openModal","closeModal","shareSubmit","e","preventDefault","current","value","collection","doc","get","then","user","data","user1","update","userId","shared","filehandle","docRef","set","merge","s","disconnect","once","document","setContents","enable","emit","interval","setInterval","getContents","clearInterval","handler","delta","oldDelta","source","on","off","updateContents","wrapperRef","wrapper","innerHTML","editor","createElement","append","q","theme","modules","toolbar","disable","setText","target"],"mappings":"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","sourcesContent":["import React,{useCallback, useEffect, useState, useRef} from 'react'\nimport Quill from \"quill\"\nimport \"quill/dist/quill.snow.css\"\nimport { io } from 'socket.io-client'\nimport { useParams } from 'react-router-dom'\nimport { useAuth } from '../../contexts/AuthContext'\nimport { faFileAlt, faShare } from '@fortawesome/free-solid-svg-icons'\nimport { Button, Modal, Form } from \"react-bootstrap\"\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { firestore } from '../../firebase'\nimport {Helmet} from \"react-helmet\";\n\nconst TOOLBAR_OPTIONS = [\n    [{ header: [1, 2, 3, 4, 5, 6, false] }],\n    [{ font: [] }],\n    [{ list: \"ordered\" }, { list: \"bullet\" }],\n    [\"bold\", \"italic\", \"underline\"],\n    [{ color: [] }, { background: [] }],\n    [{ script: \"sub\" }, { script: \"super\" }],\n    [{ align: [] }],\n    [\"image\", \"blockquote\", \"code-block\"],\n    [\"clean\"],\n    \n  ]\n\n\nconst  SAVE_INTERVAL_MS = 2000\n\nexport default function TextEditor() {\n    const {id: documentId} = useParams()\n    const [socket, setSocket] = useState()\n    const [quill, setQuill] = useState() \n    const { currentUser } = useAuth()\n    console.log(documentId)\n    console.log(\"current user is \", currentUser.uid)\n    const userid = [];\n    userid.push(currentUser.uid)\n    const [open, setOpen] = useState(false)\n    const emailRef = useRef()\n    const [name, setName] = useState(\"\")\n    \n    const docInfo = {\n      userid: userid,\n      id: documentId\n\n    }\n    function openModal() {\n        setOpen(true)\n    }\n    \n    function closeModal() {\n        setOpen(false)\n    }\n    \n    function shareSubmit(e) {\n      e.preventDefault()\n      console.log(\"email is \", emailRef.current.value)\n\n\n              console.log(\"email is \", emailRef.current.value)\n            firestore.collection('users').doc(emailRef.current.value).get().then(doc => {\n              var user = [];\n              user.push(doc.data().userid)    \n            var user1 = [];\n            user1.push(currentUser.uid)\n            user = [...user, ...user1] \n            console.log(\"user is \", user) \n              firestore.collection('documents').doc(documentId).update({\n                userId: user,\n                shared: \"yes\",\n            });\n          })\n\n        closeModal()\n      }\n\n    const filehandle = async (e) => {\n      e.preventDefault()\n        try {\n          const docRef = firestore.collection('documents').doc(documentId);\n          console.log(name)\n          const doc = await docRef.set({\n            name: name,\n            \n          },{ merge: true });\n          \n          console.log(name);\n        } catch (error) {\n          console.log(error);\n        }\n      closeModal()\n    }\n    \n\n    useEffect(() => {\n        const s = io(\"http://localhost:3001\")\n        setSocket(s);\n\n        return () => {\n            s.disconnect()\n        }\n    },[])\n\n    useEffect(() => {\n        if( socket == null || quill == null) return\n        socket.once(\"load-document\", document => {\n            console.log(document)\n            quill.setContents(document)\n            quill.enable()\n        })\n        socket.emit('get-document', docInfo)\n        //socket.emit('get-userid', userid)\n\n    },[socket, quill, docInfo])\n\n\n    \n\n    useEffect(() => {\n        if (socket == null || quill == null) return\n    \n        const interval = setInterval(() => {\n            socket.emit(\"save-document\", quill.getContents())\n        }, SAVE_INTERVAL_MS)\n    \n        return () => {\n          clearInterval(interval)\n        }\n      }, [socket, quill])\n\n    useEffect(() => {\n        if(socket == null || quill == null ) return\n\n        const handler = (delta,oldDelta, source) => {\n            if(source !== 'user') return\n            socket.emit(\"send-changes\", delta)\n        }\n        quill.on('text-change', handler)\n\n        return () => {\n            quill.off('text-change',handler)\n        }\n\n       \n    },[socket, quill])\n\n    useEffect(() => {\n        if (socket == null || quill == null) return\n    \n        const handler = delta => {\n          quill.updateContents(delta)\n        }\n        socket.on(\"receive-changes\", handler)\n    \n        return () => {\n          socket.off(\"receive-changes\", handler)\n        }\n      }, [socket, quill])\n\n\n    const wrapperRef = useCallback((wrapper) => {\n        if(wrapper == null) return\n\n        wrapper.innerHTML = \"\"\n        const editor = document.createElement(\"div\")\n        wrapper.append(editor)\n\n        const q = new Quill( editor, {theme : \"snow\", modules : {toolbar : TOOLBAR_OPTIONS}})\n        q.disable()\n        q.setText(\"Loading ...\")\n        setQuill(q)\n        \n        \n\n    },[])\n\n    return (\n    <>  \n            <Helmet>\n              <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\" integrity=\"sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T\" crossorigin=\"anonymous\"/>\n              <script src=\"https://code.jquery.com/jquery-3.3.1.slim.min.js\" integrity=\"sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo\" crossorigin=\"anonymous\"></script>\n              <script src=\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js\" integrity=\"sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1\" crossorigin=\"anonymous\"></script>\n              <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js\" integrity=\"sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM\" crossorigin=\"anonymous\"></script>\n            </Helmet>\n\n<button type=\"button\" className=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#exampleModal\">\n  Rename File\n</button>\n\n<div className=\"modal fade\" id=\"exampleModal\" tabIndex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n  <div className=\"modal-dialog\" role=\"document\">\n    <div className=\"modal-content\">\n      <div className=\"modal-header\">\n        <h5 className=\"modal-title\" id=\"exampleModalLabel\">File Name</h5>\n        <button type=\"button\" className=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n          <span aria-hidden=\"true\">&times;</span>\n        </button>\n      </div>\n      <Form onSubmit={filehandle}>\n        <div className=\"modal-body\">\n          <Form.Group>\n                <Form.Label>Document Name</Form.Label>\n                <Form.Control\n                  type=\"text\"\n                  required\n                  value={name}\n                  onChange={e => setName(e.target.value)}\n                />\n          </Form.Group>\n        </div>\n      \n        <div className=\"modal-footer\">\n          <button type=\"button\" className=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button>\n          <button type=\"submit\" className=\"btn btn-primary\">Save changes</button>\n        </div>\n      </Form>\n    </div>\n  </div>\n</div>\n            <Button onClick={openModal} variant=\"outline-success\" size=\"sm\">\n            <FontAwesomeIcon icon={faShare} />\n            </Button>\n            <Modal show={open} onHide={closeModal}>\n                <Form onSubmit={shareSubmit}>\n                <Modal.Body>\n                    <Form.Group>\n                    <Form.Label>User Email</Form.Label>\n                    <Form.Control\n                        type=\"email\"\n                        ref={emailRef} required\n                    />\n                    </Form.Group>\n                </Modal.Body>\n                <Modal.Footer>\n                    <Button variant=\"secondary\" onClick={closeModal}>\n                    Close\n                    </Button>\n                    <Button variant=\"success\" type=\"submit\">\n                    Enter\n                    </Button>\n                </Modal.Footer>\n                </Form>\n            </Modal>\n            <div className=\"container\" ref = {wrapperRef}></div>\n        \n    </>    \n\n    )\n}\n\n"]},"metadata":{},"sourceType":"module"}