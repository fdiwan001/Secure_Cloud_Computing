{"ast":null,"code":"var _jsxFileName = \"/home/kali/Desktop/Secure_Cloud_Computing/src/Component/Document/TextEditor.js\",\n    _s = $RefreshSig$();\n\nimport React, { useCallback, useEffect, useState, useRef } from 'react';\nimport Quill from \"quill\";\nimport \"quill/dist/quill.snow.css\";\nimport { io } from 'socket.io-client';\nimport { useParams } from 'react-router-dom';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { faFileAlt, faShare } from '@fortawesome/free-solid-svg-icons';\nimport { Button, Modal, Form } from \"react-bootstrap\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { firestore } from '../../firebase';\nimport { Helmet } from \"react-helmet\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst TOOLBAR_OPTIONS = [[{\n  header: [1, 2, 3, 4, 5, 6, false]\n}], [{\n  font: []\n}], [{\n  list: \"ordered\"\n}, {\n  list: \"bullet\"\n}], [\"bold\", \"italic\", \"underline\"], [{\n  color: []\n}, {\n  background: []\n}], [{\n  script: \"sub\"\n}, {\n  script: \"super\"\n}], [{\n  align: []\n}], [\"image\", \"blockquote\", \"code-block\"], [\"clean\"]];\nconst SAVE_INTERVAL_MS = 2000;\nexport default function TextEditor() {\n  _s();\n\n  const {\n    id: documentId\n  } = useParams();\n  const [socket, setSocket] = useState();\n  const [quill, setQuill] = useState();\n  const {\n    currentUser\n  } = useAuth();\n  console.log(documentId);\n  console.log(\"current user is \", currentUser.uid);\n  const userid = [];\n  userid.push(currentUser.uid);\n  const [open, setOpen] = useState(false);\n  const emailRef = useRef();\n  const [name, setName] = useState(\"\");\n  const docInfo = {\n    userid: userid,\n    id: documentId\n  };\n\n  function openModal() {\n    setOpen(true);\n  }\n\n  function closeModal() {\n    setOpen(false);\n  }\n\n  function shareSubmit(e) {\n    e.preventDefault();\n    console.log(\"email is \", emailRef.current.value);\n    console.log(\"email is \", emailRef.current.value);\n    firestore.collection('users').doc(emailRef.current.value).get().then(doc => {\n      var user = [];\n      user.push(doc.data().userid);\n      var user1 = [];\n      user1.push(currentUser.uid);\n      user = [...user, ...user1];\n      console.log(\"user is \", user);\n      firestore.collection('documents').doc(documentId).update({\n        userId: user,\n        shared: \"yes\"\n      });\n    });\n    closeModal();\n  }\n\n  const filehandle = async e => {\n    e.preventDefault();\n\n    try {\n      const docRef = firestore.collection('documents').doc(documentId);\n      console.log(name);\n      const doc = await docRef.set({\n        name: name\n      }, {\n        merge: true\n      });\n      console.log(name);\n    } catch (error) {\n      console.log(error);\n    }\n\n    closeModal();\n  };\n\n  useEffect(() => {\n    const s = io(\"http://secure-cloud-computing-server-branch-c2hzr5vfpq-uc.a.run.app:8080\");\n    setSocket(s);\n    return () => {\n      s.disconnect();\n    };\n  }, []);\n  useEffect(() => {\n    if (socket == null || quill == null) return;\n    socket.once(\"load-document\", document => {\n      console.log(document);\n      quill.setContents(document);\n      quill.enable();\n    });\n    socket.emit('get-document', docInfo); //socket.emit('get-userid', userid)\n  }, [socket, quill, docInfo]);\n  useEffect(() => {\n    if (socket == null || quill == null) return;\n    const interval = setInterval(() => {\n      socket.emit(\"save-document\", quill.getContents());\n    }, SAVE_INTERVAL_MS);\n    return () => {\n      clearInterval(interval);\n    };\n  }, [socket, quill]);\n  useEffect(() => {\n    if (socket == null || quill == null) return;\n\n    const handler = (delta, oldDelta, source) => {\n      if (source !== 'user') return;\n      socket.emit(\"send-changes\", delta);\n    };\n\n    quill.on('text-change', handler);\n    return () => {\n      quill.off('text-change', handler);\n    };\n  }, [socket, quill]);\n  useEffect(() => {\n    if (socket == null || quill == null) return;\n\n    const handler = delta => {\n      quill.updateContents(delta);\n    };\n\n    socket.on(\"receive-changes\", handler);\n    return () => {\n      socket.off(\"receive-changes\", handler);\n    };\n  }, [socket, quill]);\n  const wrapperRef = useCallback(wrapper => {\n    if (wrapper == null) return;\n    wrapper.innerHTML = \"\";\n    const editor = document.createElement(\"div\");\n    wrapper.append(editor);\n    const q = new Quill(editor, {\n      theme: \"snow\",\n      modules: {\n        toolbar: TOOLBAR_OPTIONS\n      }\n    });\n    q.disable();\n    q.setText(\"Loading ...\");\n    setQuill(q);\n  }, []);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Helmet, {\n      children: [/*#__PURE__*/_jsxDEV(\"link\", {\n        rel: \"stylesheet\",\n        href: \"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\",\n        integrity: \"sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T\",\n        crossorigin: \"anonymous\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"script\", {\n        src: \"https://code.jquery.com/jquery-3.3.1.slim.min.js\",\n        integrity: \"sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo\",\n        crossorigin: \"anonymous\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"script\", {\n        src: \"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js\",\n        integrity: \"sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1\",\n        crossorigin: \"anonymous\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"script\", {\n        src: \"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js\",\n        integrity: \"sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM\",\n        crossorigin: \"anonymous\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 15\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      type: \"button\",\n      className: \"btn btn-primary\",\n      \"data-toggle\": \"modal\",\n      \"data-target\": \"#exampleModal\",\n      children: \"Rename File\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 1\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"modal fade\",\n      id: \"exampleModal\",\n      tabIndex: \"-1\",\n      role: \"dialog\",\n      \"aria-labelledby\": \"exampleModalLabel\",\n      \"aria-hidden\": \"true\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"modal-dialog\",\n        role: \"document\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modal-content\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"modal-header\",\n            children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n              className: \"modal-title\",\n              id: \"exampleModalLabel\",\n              children: \"File Name\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 194,\n              columnNumber: 9\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              className: \"close\",\n              \"data-dismiss\": \"modal\",\n              \"aria-label\": \"Close\",\n              children: /*#__PURE__*/_jsxDEV(\"span\", {\n                \"aria-hidden\": \"true\",\n                children: \"\\xD7\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 196,\n                columnNumber: 11\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 195,\n              columnNumber: 9\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 193,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(Form, {\n            onSubmit: filehandle,\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"modal-body\",\n              children: /*#__PURE__*/_jsxDEV(Form.Group, {\n                children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n                  children: \"Document Name\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 202,\n                  columnNumber: 17\n                }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n                  type: \"text\",\n                  required: true,\n                  value: name,\n                  onChange: e => setName(e.target.value)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 203,\n                  columnNumber: 17\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 201,\n                columnNumber: 11\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 200,\n              columnNumber: 9\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"modal-footer\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: \"btn btn-secondary\",\n                \"data-dismiss\": \"modal\",\n                children: \"Close\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 213,\n                columnNumber: 11\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"submit\",\n                className: \"btn btn-primary\",\n                children: \"Save changes\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 214,\n                columnNumber: 11\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 212,\n              columnNumber: 9\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 199,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 5\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 3\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 1\n    }, this), /*#__PURE__*/_jsxDEV(Button, {\n      onClick: openModal,\n      variant: \"outline-success\",\n      size: \"sm\",\n      children: /*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n        icon: faShare\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      show: open,\n      onHide: closeModal,\n      children: /*#__PURE__*/_jsxDEV(Form, {\n        onSubmit: shareSubmit,\n        children: [/*#__PURE__*/_jsxDEV(Modal.Body, {\n          children: /*#__PURE__*/_jsxDEV(Form.Group, {\n            children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n              children: \"User Email\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 227,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n              type: \"email\",\n              ref: emailRef,\n              required: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 228,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 226,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            variant: \"secondary\",\n            onClick: closeModal,\n            children: \"Close\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 235,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"success\",\n            type: \"submit\",\n            children: \"Enter\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 238,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      ref: wrapperRef\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true);\n}\n\n_s(TextEditor, \"1Gptrb0aCGv76BWpT+FlEwZCAvY=\", false, function () {\n  return [useParams, useAuth];\n});\n\n_c = TextEditor;\n\nvar _c;\n\n$RefreshReg$(_c, \"TextEditor\");","map":{"version":3,"sources":["/home/kali/Desktop/Secure_Cloud_Computing/src/Component/Document/TextEditor.js"],"names":["React","useCallback","useEffect","useState","useRef","Quill","io","useParams","useAuth","faFileAlt","faShare","Button","Modal","Form","FontAwesomeIcon","firestore","Helmet","TOOLBAR_OPTIONS","header","font","list","color","background","script","align","SAVE_INTERVAL_MS","TextEditor","id","documentId","socket","setSocket","quill","setQuill","currentUser","console","log","uid","userid","push","open","setOpen","emailRef","name","setName","docInfo","openModal","closeModal","shareSubmit","e","preventDefault","current","value","collection","doc","get","then","user","data","user1","update","userId","shared","filehandle","docRef","set","merge","error","s","disconnect","once","document","setContents","enable","emit","interval","setInterval","getContents","clearInterval","handler","delta","oldDelta","source","on","off","updateContents","wrapperRef","wrapper","innerHTML","editor","createElement","append","q","theme","modules","toolbar","disable","setText","target"],"mappings":"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","sourcesContent":["import React,{useCallback, useEffect, useState, useRef} from 'react'\nimport Quill from \"quill\"\nimport \"quill/dist/quill.snow.css\"\nimport { io } from 'socket.io-client'\nimport { useParams } from 'react-router-dom'\nimport { useAuth } from '../../contexts/AuthContext'\nimport { faFileAlt, faShare } from '@fortawesome/free-solid-svg-icons'\nimport { Button, Modal, Form } from \"react-bootstrap\"\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { firestore } from '../../firebase'\nimport {Helmet} from \"react-helmet\";\n\nconst TOOLBAR_OPTIONS = [\n    [{ header: [1, 2, 3, 4, 5, 6, false] }],\n    [{ font: [] }],\n    [{ list: \"ordered\" }, { list: \"bullet\" }],\n    [\"bold\", \"italic\", \"underline\"],\n    [{ color: [] }, { background: [] }],\n    [{ script: \"sub\" }, { script: \"super\" }],\n    [{ align: [] }],\n    [\"image\", \"blockquote\", \"code-block\"],\n    [\"clean\"],\n    \n  ]\n\n\nconst  SAVE_INTERVAL_MS = 2000\n\nexport default function TextEditor() {\n    const {id: documentId} = useParams()\n    const [socket, setSocket] = useState()\n    const [quill, setQuill] = useState() \n    const { currentUser } = useAuth()\n    console.log(documentId)\n    console.log(\"current user is \", currentUser.uid)\n    const userid = [];\n    userid.push(currentUser.uid)\n    const [open, setOpen] = useState(false)\n    const emailRef = useRef()\n    const [name, setName] = useState(\"\")\n    \n    const docInfo = {\n      userid: userid,\n      id: documentId\n\n    }\n    function openModal() {\n        setOpen(true)\n    }\n    \n    function closeModal() {\n        setOpen(false)\n    }\n    \n    function shareSubmit(e) {\n      e.preventDefault()\n      console.log(\"email is \", emailRef.current.value)\n\n\n              console.log(\"email is \", emailRef.current.value)\n            firestore.collection('users').doc(emailRef.current.value).get().then(doc => {\n              var user = [];\n              user.push(doc.data().userid)    \n            var user1 = [];\n            user1.push(currentUser.uid)\n            user = [...user, ...user1] \n            console.log(\"user is \", user) \n              firestore.collection('documents').doc(documentId).update({\n                userId: user,\n                shared: \"yes\",\n            });\n          })\n\n        closeModal()\n      }\n\n    const filehandle = async (e) => {\n      e.preventDefault()\n        try {\n          const docRef = firestore.collection('documents').doc(documentId);\n          console.log(name)\n          const doc = await docRef.set({\n            name: name,\n            \n          },{ merge: true });\n          \n          console.log(name);\n        } catch (error) {\n          console.log(error);\n        }\n      closeModal()\n    }\n    \n\n    useEffect(() => {\n        const s = io(\"http://secure-cloud-computing-server-branch-c2hzr5vfpq-uc.a.run.app:8080\")\n        setSocket(s);\n\n        return () => {\n            s.disconnect()\n        }\n    },[])\n\n    useEffect(() => {\n        if( socket == null || quill == null) return\n        socket.once(\"load-document\", document => {\n            console.log(document)\n            quill.setContents(document)\n            quill.enable()\n        })\n        socket.emit('get-document', docInfo)\n        //socket.emit('get-userid', userid)\n\n    },[socket, quill, docInfo])\n\n\n    \n\n    useEffect(() => {\n        if (socket == null || quill == null) return\n    \n        const interval = setInterval(() => {\n            socket.emit(\"save-document\", quill.getContents())\n        }, SAVE_INTERVAL_MS)\n    \n        return () => {\n          clearInterval(interval)\n        }\n      }, [socket, quill])\n\n    useEffect(() => {\n        if(socket == null || quill == null ) return\n\n        const handler = (delta,oldDelta, source) => {\n            if(source !== 'user') return\n            socket.emit(\"send-changes\", delta)\n        }\n        quill.on('text-change', handler)\n\n        return () => {\n            quill.off('text-change',handler)\n        }\n\n       \n    },[socket, quill])\n\n    useEffect(() => {\n        if (socket == null || quill == null) return\n    \n        const handler = delta => {\n          quill.updateContents(delta)\n        }\n        socket.on(\"receive-changes\", handler)\n    \n        return () => {\n          socket.off(\"receive-changes\", handler)\n        }\n      }, [socket, quill])\n\n\n    const wrapperRef = useCallback((wrapper) => {\n        if(wrapper == null) return\n\n        wrapper.innerHTML = \"\"\n        const editor = document.createElement(\"div\")\n        wrapper.append(editor)\n\n        const q = new Quill( editor, {theme : \"snow\", modules : {toolbar : TOOLBAR_OPTIONS}})\n        q.disable()\n        q.setText(\"Loading ...\")\n        setQuill(q)\n        \n        \n\n    },[])\n\n    return (\n    <>  \n            <Helmet>\n              <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\" integrity=\"sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T\" crossorigin=\"anonymous\"/>\n              <script src=\"https://code.jquery.com/jquery-3.3.1.slim.min.js\" integrity=\"sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo\" crossorigin=\"anonymous\"></script>\n              <script src=\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js\" integrity=\"sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1\" crossorigin=\"anonymous\"></script>\n              <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js\" integrity=\"sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM\" crossorigin=\"anonymous\"></script>\n            </Helmet>\n\n<button type=\"button\" className=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#exampleModal\">\n  Rename File\n</button>\n\n<div className=\"modal fade\" id=\"exampleModal\" tabIndex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n  <div className=\"modal-dialog\" role=\"document\">\n    <div className=\"modal-content\">\n      <div className=\"modal-header\">\n        <h5 className=\"modal-title\" id=\"exampleModalLabel\">File Name</h5>\n        <button type=\"button\" className=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n          <span aria-hidden=\"true\">&times;</span>\n        </button>\n      </div>\n      <Form onSubmit={filehandle}>\n        <div className=\"modal-body\">\n          <Form.Group>\n                <Form.Label>Document Name</Form.Label>\n                <Form.Control\n                  type=\"text\"\n                  required\n                  value={name}\n                  onChange={e => setName(e.target.value)}\n                />\n          </Form.Group>\n        </div>\n      \n        <div className=\"modal-footer\">\n          <button type=\"button\" className=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button>\n          <button type=\"submit\" className=\"btn btn-primary\">Save changes</button>\n        </div>\n      </Form>\n    </div>\n  </div>\n</div>\n            <Button onClick={openModal} variant=\"outline-success\" size=\"sm\">\n            <FontAwesomeIcon icon={faShare} />\n            </Button>\n            <Modal show={open} onHide={closeModal}>\n                <Form onSubmit={shareSubmit}>\n                <Modal.Body>\n                    <Form.Group>\n                    <Form.Label>User Email</Form.Label>\n                    <Form.Control\n                        type=\"email\"\n                        ref={emailRef} required\n                    />\n                    </Form.Group>\n                </Modal.Body>\n                <Modal.Footer>\n                    <Button variant=\"secondary\" onClick={closeModal}>\n                    Close\n                    </Button>\n                    <Button variant=\"success\" type=\"submit\">\n                    Enter\n                    </Button>\n                </Modal.Footer>\n                </Form>\n            </Modal>\n            <div className=\"container\" ref = {wrapperRef}></div>\n        \n    </>    \n\n    )\n}\n\n"]},"metadata":{},"sourceType":"module"}